<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Guide - RedBoxVM Documentation</title>
    <meta name="description" content="Deep dive into RedBoxVM's technical architecture, virtualization engine, and security model.">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/docs.css">
    <link rel="stylesheet" href="../assets/css/animations.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="../assets/icons/favicon.svg">
    
    <!-- Mermaid for diagrams -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
</head>

<body>
    <!-- Navigation -->
    <nav class="nav" id="nav">
        <div class="nav-container">
            <div class="nav-brand">
                <img src="../assets/icons/favicon.svg" alt="RedBoxVM" class="nav-logo" style="width: 48px; height: 48px;" />
                <span class="nav-title" style="color: white;">RedBoxVM</span>
            </div>

            <div class="nav-menu" id="nav-menu">
                <a href="../index.html" class="nav-link">Home</a>
                <a href="../index.html#features" class="nav-link">Features</a>
                <a href="../index.html#architecture" class="nav-link">Architecture</a>
                <a href="getting-started.html" class="nav-link active">Documentation</a>
                <a href="../index.html#download" class="nav-link">Download</a>
            </div>

            <div class="nav-actions">
                <button class="theme-toggle" id="theme-toggle" title="Toggle dark/light mode">
                    <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="5" />
                        <line x1="12" y1="1" x2="12" y2="3" />
                        <line x1="12" y1="21" x2="12" y2="23" />
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                        <line x1="1" y1="12" x2="3" y2="12" />
                        <line x1="21" y1="12" x2="23" y2="12" />
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                    </svg>
                    <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                </button>
                <a href="https://github.com/TheRedXStudio/RedBoxVM" class="nav-github" target="_blank" rel="noopener">
                    <img src="../assets/icons/favicon.svg" alt="RedBoxVM" style="width: 24px; height: 24px;" />
                </a>
            </div>
        </div>
    </nav>

    <!-- Documentation Container -->
    <div class="docs-container">
        <!-- Sidebar Navigation -->
        <aside class="docs-sidebar">
            <h3 class="docs-nav-title">Documentation</h3>
            <nav class="docs-nav">
                <ul>
                    <li class="docs-nav-item">
                        <a href="getting-started.html" class="docs-nav-link">Getting Started</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="architecture.html" class="docs-nav-link active">Architecture</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="api-reference.html" class="docs-nav-link">API Reference</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="security.html" class="docs-nav-link">Security Guide</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="build-guide.html" class="docs-nav-link">Build Guide</a>
                    </li>
                    <li class="docs-nav-item">
                        <a href="examples.html" class="docs-nav-link">Examples</a>
                    </li>
                </ul>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="docs-content">
            <div class="docs-breadcrumb">
                <a href="../index.html">Home</a>
                <span class="docs-breadcrumb-separator">/</span>
                <a href="getting-started.html">Documentation</a>
                <span class="docs-breadcrumb-separator">/</span>
                <span>Architecture</span>
            </div>

            <h1>RedBoxVM Architecture</h1>
            
            <p>RedBoxVM employs a sophisticated multi-layer architecture designed for maximum security, performance, and compatibility. This guide provides a comprehensive overview of the system's technical design and implementation.</p>

            <h2>System Architecture Overview</h2>
            
            <p>The RedBoxVM architecture consists of multiple interconnected layers, each responsible for specific aspects of the virtualization process:</p>

            <div class="mermaid">
graph TB
    subgraph "Host Android System"
        HS[Host System Services]
        HK[Host Kernel]
        HD[Host Hardware]
    end
    
    subgraph "RedBox Virtualization Layer"
        subgraph "Application Layer"
            UI[RedBox UI]
            AM[App Manager]
            IM[Instance Manager]
        end
        
        subgraph "Core Engine"
            VL[Virtualization Layer]
            SH[System Hooks]
            PM[Process Manager]
        end
        
        subgraph "Native Layer (C++)"
            DF[Dobby Framework]
            JB[JNI Bridge]
            SC[System Call Interceptor]
        end
    end
    
    subgraph "Virtual Environment 1"
        VA1[Virtual App 1]
        VS1[Virtual Services 1]
        VF1[Virtual File System 1]
    end
    
    subgraph "Virtual Environment 2"
        VA2[Virtual App 2]
        VS2[Virtual Services 2]
        VF2[Virtual File System 2]
    end
    
    subgraph "Virtual Environment N"
        VAN[Virtual App N]
        VSN[Virtual Services N]
        VFN[Virtual File System N]
    end
    
    UI --> AM
    AM --> IM
    IM --> VL
    VL --> SH
    SH --> PM
    PM --> DF
    DF --> JB
    JB --> SC
    SC --> HK
    
    VL --> VA1
    VL --> VA2
    VL --> VAN
    
    VA1 --> VS1
    VA2 --> VS2
    VAN --> VSN
    
    VS1 --> VF1
    VS2 --> VF2
    VSN --> VFN
    
    HK --> HD
    HS --> HK
            </div>

            <h2>Layer-by-Layer Breakdown</h2>

            <h3>Application Layer</h3>
            
            <p>The topmost layer provides the user interface and high-level management functionality:</p>

            <ul>
                <li><strong>RedBox UI:</strong> Modern Material Design interface for user interactions</li>
                <li><strong>App Manager:</strong> Handles app discovery, installation, and lifecycle management</li>
                <li><strong>Instance Manager:</strong> Manages virtual app instances and their configurations</li>
            </ul>

            <div class="alert alert-info">
                <strong>Design Pattern:</strong> The Application Layer follows the MVP (Model-View-Presenter) pattern for clean separation of concerns and testability.
            </div>

            <h3>Core Engine</h3>
            
            <p>The core virtualization engine responsible for creating and managing virtual environments:</p>

            <div class="mermaid">
graph LR
    subgraph "Core Engine Components"
        VL[Virtualization Layer]
        SH[System Hooks]
        PM[Process Manager]
        
        VL --> SH
        SH --> PM
        PM --> VL
    end
    
    subgraph "Responsibilities"
        R1[Environment Creation]
        R2[System Call Interception]
        R3[Process Isolation]
        R4[Resource Management]
    end
    
    VL --> R1
    SH --> R2
    PM --> R3
    PM --> R4
            </div>

            <h3>Native Layer (C++)</h3>
            
            <p>Low-level implementation providing optimal performance and system integration:</p>

            <table>
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Purpose</th>
                        <th>Technology</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Dobby Framework</td>
                        <td>Function hooking and interception</td>
                        <td>ARM64/ARM32 assembly</td>
                    </tr>
                    <tr>
                        <td>JNI Bridge</td>
                        <td>Java-Native communication</td>
                        <td>JNI, C++ STL</td>
                    </tr>
                    <tr>
                        <td>System Call Interceptor</td>
                        <td>Kernel-level call interception</td>
                        <td>ptrace, seccomp-bpf</td>
                    </tr>
                </tbody>
            </table>

            <h2>Component Interaction Flow</h2>
            
            <p>Understanding how components interact is crucial for debugging and optimization:</p>

            <div class="mermaid">
sequenceDiagram
    participant User
    participant RedBoxUI
    participant AppManager
    participant Core
    participant VirtualEnv
    participant HostSystem
    
    User->>RedBoxUI: Launch RedBox
    RedBoxUI->>AppManager: Initialize
    AppManager->>Core: Start Virtualization Engine
    Core->>HostSystem: Hook System Services
    
    User->>RedBoxUI: Select App to Clone
    RedBoxUI->>AppManager: Create Virtual Instance
    AppManager->>Core: Allocate Virtual Environment
    Core->>VirtualEnv: Initialize Sandbox
    VirtualEnv->>Core: Environment Ready
    Core->>AppManager: Instance Created
    AppManager->>RedBoxUI: Update UI
    
    User->>RedBoxUI: Launch Virtual App
    RedBoxUI->>AppManager: Start Instance
    AppManager->>Core: Execute in Virtual Environment
    Core->>VirtualEnv: Launch App Process
    VirtualEnv->>Core: App Running
    Core->>HostSystem: Manage Resources
            </div>

            <h2>Virtualization Process</h2>
            
            <p>The app virtualization process follows a carefully orchestrated sequence:</p>

            <div class="mermaid">
flowchart TD
    A[User Selects App] --> B{App Already Installed?}
    B -->|Yes| C[Scan App Components]
    B -->|No| D[Install App First]
    D --> C
    
    C --> E[Create Virtual Environment]
    E --> F[Initialize Virtual File System]
    F --> G[Setup Virtual Services]
    G --> H[Configure Virtual Network]
    H --> I[Apply Security Sandbox]
    I --> J[Register Virtual Instance]
    J --> K[Virtual App Ready]
    
    K --> L[User Launches Virtual App]
    L --> M[Load in Virtual Environment]
    M --> N[Hook System Calls]
    N --> O[Redirect File Operations]
    O --> P[Virtualize System Services]
    P --> Q[App Running Isolated]
    
    Q --> R{App Requests System Service?}
    R -->|Yes| S[Intercept Request]
    S --> T[Route to Virtual Service]
    T --> U[Process in Sandbox]
    U --> V[Return Virtual Response]
    V --> Q
    R -->|No| W[Continue Normal Execution]
    W --> Q
            </div>

            <h2>System Service Virtualization</h2>
            
            <p>RedBoxVM virtualizes Android system services to provide complete isolation:</p>

            <div class="mermaid">
graph LR
    subgraph "Virtual App Process"
        VA[Virtual App]
        VR[Virtual Runtime]
    end
    
    subgraph "Virtualization Layer"
        SH[System Hooks]
        PM[Proxy Manager]
        VS[Virtual Services]
    end
    
    subgraph "Host System"
        AS[Activity Manager]
        PS[Package Manager]
        CS[Content Resolver]
        NS[Notification Service]
    end
    
    VA --> VR
    VR --> SH
    SH --> PM
    PM --> VS
    
    VS -.->|Filtered| AS
    VS -.->|Sandboxed| PS
    VS -.->|Isolated| CS
    VS -.->|Virtual| NS
    
    VS --> |Virtual Response| PM
    PM --> |Hooked Response| SH
    SH --> |App Response| VR
    VR --> |Result| VA
            </div>

            <h2>Memory Management</h2>
            
            <p>RedBoxVM implements sophisticated memory management to ensure optimal performance:</p>

            <h3>Memory Isolation</h3>
            <ul>
                <li><strong>Process Separation:</strong> Each virtual app runs in its own process space</li>
                <li><strong>Memory Protection:</strong> Virtual apps cannot access each other's memory</li>
                <li><strong>Garbage Collection:</strong> Automatic cleanup of unused virtual environments</li>
            </ul>

            <h3>Performance Optimization</h3>
            <ul>
                <li><strong>Copy-on-Write:</strong> Shared resources are duplicated only when modified</li>
                <li><strong>Memory Pooling:</strong> Reuse of memory blocks for better performance</li>
                <li><strong>Lazy Loading:</strong> Components are loaded only when needed</li>
            </ul>

            <h2>File System Virtualization</h2>
            
            <p>Each virtual app gets its own isolated file system:</p>

            <pre><code>/data/data/com.redbox.vm/
├── virtual_envs/
│   ├── env_1/
│   │   ├── data/
│   │   ├── cache/
│   │   └── files/
│   ├── env_2/
│   │   ├── data/
│   │   ├── cache/
│   │   └── files/
│   └── env_n/
├── shared/
│   ├── libs/
│   └── resources/
└── config/
    ├── hooks.json
    └── policies.json</code></pre>

            <h2>Network Virtualization</h2>
            
            <p>Network traffic is isolated and can be routed through different interfaces:</p>

            <div class="mermaid">
graph TB
    subgraph "Virtual Apps"
        VA1[Virtual App 1]
        VA2[Virtual App 2]
        VAN[Virtual App N]
    end
    
    subgraph "Network Virtualization Layer"
        NV[Network Virtualizer]
        VPN[VPN Interface]
        PROXY[Proxy Manager]
    end
    
    subgraph "Host Network"
        WIFI[WiFi Interface]
        MOBILE[Mobile Data]
        ETH[Ethernet]
    end
    
    VA1 --> NV
    VA2 --> NV
    VAN --> NV
    
    NV --> VPN
    NV --> PROXY
    
    VPN --> WIFI
    PROXY --> MOBILE
    NV --> ETH
            </div>

            <h2>Performance Characteristics</h2>
            
            <table>
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Native App</th>
                        <th>Virtual App</th>
                        <th>Overhead</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Launch Time</td>
                        <td>1.2s</td>
                        <td>1.4s</td>
                        <td>+16%</td>
                    </tr>
                    <tr>
                        <td>Memory Usage</td>
                        <td>45MB</td>
                        <td>52MB</td>
                        <td>+15%</td>
                    </tr>
                    <tr>
                        <td>CPU Usage</td>
                        <td>12%</td>
                        <td>14%</td>
                        <td>+17%</td>
                    </tr>
                    <tr>
                        <td>Battery Impact</td>
                        <td>100%</td>
                        <td>108%</td>
                        <td>+8%</td>
                    </tr>
                </tbody>
            </table>

            <div class="alert alert-success">
                <strong>Performance Note:</strong> RedBoxVM maintains excellent performance with minimal overhead, making it suitable for production use.
            </div>

            <h2>Scalability and Limits</h2>
            
            <ul>
                <li><strong>Maximum Virtual Apps:</strong> Limited by available system memory</li>
                <li><strong>Concurrent Instances:</strong> Up to 10 active virtual apps simultaneously</li>
                <li><strong>Storage Overhead:</strong> ~50MB per virtual environment</li>
                <li><strong>Memory Overhead:</strong> ~15% per virtual app instance</li>
            </ul>

            <!-- Navigation -->
            <div class="docs-navigation">
                <a href="getting-started.html" class="docs-nav-btn">
                    ← Getting Started
                </a>
                <a href="api-reference.html" class="docs-nav-btn">
                    API Reference →
                </a>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/docs.js"></script>
</body>

</html>